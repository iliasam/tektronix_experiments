#NO_APP
	.file	"tetris.c"
	.globl	pieceShapes
	.data
	.type	pieceShapes, @object
	.size	pieceShapes, 448
pieceShapes:
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	1
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	1
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	1
	.byte	1
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.byte	0
	.byte	1
	.byte	0
	.byte	0
	.globl	playfield
    .bss
	.type	playfield, @object
	.size	playfield, 200
playfield:
	.zero	200
	.globl	nextpieces
	.type	nextpieces, @object
	.size	nextpieces, 7
nextpieces:
	.zero	7
	.globl	playfield_changed
	.type	playfield_changed, @object
	.size	playfield_changed, 1
playfield_changed:
	.zero	1
	.globl	piecex
	.type	piecex, @object
	.size	piecex, 1
piecex:
	.zero	1
	.globl	piecey
	.type	piecey, @object
	.size	piecey, 1
piecey:
	.zero	1
	.globl	nextcursor
	.type	nextcursor, @object
	.size	nextcursor, 1
nextcursor:
	.zero	1
	.globl	piecetype
	.type	piecetype, @object
	.size	piecetype, 1
piecetype:
	.zero	1
	.globl	piecerotation
	.type	piecerotation, @object
	.size	piecerotation, 1
piecerotation:
	.zero	1
	.globl	turntimeleft
	.data
	.type	turntimeleft, @object
	.size	turntimeleft, 1
turntimeleft:
	.byte	20
	.globl	speedup
    .bss
	.type	speedup, @object
	.size	speedup, 1
speedup:
	.zero	1
	.globl	tetris_lines
	.align	2
	.type	tetris_lines, @object
	.size	tetris_lines, 2
tetris_lines:
	.zero	2
	.globl	game_over
	.type	game_over, @object
	.size	game_over, 1
game_over:
	.zero	1
	.globl	test_cnt
	.type	test_cnt, @object
	.size	test_cnt, 1
test_cnt:
	.zero	1
	.globl	prev_piecex
	.type	prev_piecex, @object
	.size	prev_piecex, 1
prev_piecex:
	.zero	1
	.globl	prev_piecey
	.type	prev_piecey, @object
	.size	prev_piecey, 1
prev_piecey:
	.zero	1
	.globl	prev_piecerotation
	.type	prev_piecerotation, @object
	.size	prev_piecerotation, 1
prev_piecerotation:
	.zero	1
	.globl	prev_piecetype
	.type	prev_piecetype, @object
	.size	prev_piecetype, 1
prev_piecetype:
	.zero	1
	.data
.LC0:
	.string	"TETRIS FOR TDS5XX OSCILLOSCOPE. ILIASAM 2023.\n"
.LC1:
	.string	"mess:state OFF"
.LC2:
	.string	"TETRIS DONE\n"
	.text
	.align	2
	.globl	tetris
	.type	tetris, @function
tetris:
	link.w %fp,#-8
	pea .LC0
	jsr _printf
	addq.l #4,%sp
	clr.l -(%sp)
	clr.l -(%sp)
	jsr _dsyDiagFillTextPlane
	addq.l #8,%sp
	jsr _clearDisplay
	jsr tetris_prepare
	pea 10.w
	jsr _millisecondsToTicks
	addq.l #4,%sp
	move.w %d0,-2(%fp)
	clr.b -3(%fp)
	jra .L2
.L3:
	jsr read_key_func
	move.w %d0,-6(%fp)
	clr.l %d0
	move.w -6(%fp),%d0
	move.l %d0,-(%sp)
	jsr tetris_cycle
	addq.l #4,%sp
	clr.l %d0
	move.w -2(%fp),%d0
	move.l %d0,-(%sp)
	jsr _taskDelay
	addq.l #4,%sp
.L2:
	move.b game_over,%d0
	tst.b %d0
	jeq .L3
	pea .LC1
	jsr _GpibInput
	addq.l #4,%sp
	jsr _ringBell
	pea .LC2
	jsr _printf
	addq.l #4,%sp
	clr.l %d0
	unlk %fp
	rts
	.size	tetris, .-tetris
	.align	2
	.globl	read_key_func
	.type	read_key_func, @function
read_key_func:
	link.w %fp,#-4
	move.l #89694836,%d0
	move.l %d0,%a0
	move.w (%a0),-2(%fp)
	move.l #89694836,%d0
	move.l %d0,%a0
	clr.w (%a0)
	move.w -2(%fp),%d0
	unlk %fp
	rts
	.size	read_key_func, .-read_key_func
	.data
.LC3:
	.string	"mess:box 350,200,480,250"
	.text
	.align	2
	.globl	tetris_prepare
	.type	tetris_prepare, @function
tetris_prepare:
	link.w %fp,#-12
	clr.l -4(%fp)
	jra .L8
.L11:
	clr.l -8(%fp)
	jra .L9
.L10:
	move.l -8(%fp),%d0
	lsl.l #2,%d0
	move.l %d0,%d1
	lsl.l #2,%d1
	add.l %d1,%d0
	add.l -4(%fp),%d0
	add.l #playfield,%d0
	move.l %d0,%a0
	clr.b (%a0)
	addq.l #1,-8(%fp)
.L9:
	moveq #9,%d0
	cmp.l -8(%fp),%d0
	jge .L10
	addq.l #1,-4(%fp)
.L8:
	moveq #19,%d0
	cmp.l -4(%fp),%d0
	jge .L11
	move.b #1,playfield_changed
	clr.l -4(%fp)
	jra .L12
.L13:
	move.l -4(%fp),%d0
	add.l #nextpieces,%d0
	move.l %d0,%a0
	clr.b (%a0)
	addq.l #1,-4(%fp)
.L12:
	moveq #5,%d0
	cmp.l -4(%fp),%d0
	jge .L13
	jsr generate_next_pieces
	move.b #4,piecex
	move.b #1,piecey
	clr.b piecerotation
	clr.b nextcursor
	move.b nextcursor,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b nextpieces(%d1.l),%d1
	move.b %d1,piecetype
	addq.b #1,%d0
	move.b %d0,nextcursor
	clr.b speedup
	clr.w tetris_lines
	move.b #20,turntimeleft
	clr.b game_over
	jsr paint_playfield
	jsr paint_next_piece
	move.w #241,-10(%fp)
	move.w #462,-12(%fp)
	move.w -12(%fp),%d0
	ext.l %d0
	pea 15.w
	move.l %d0,-(%sp)
	clr.l -(%sp)
	pea 8.w
	jsr _vertLine
	lea (16,%sp),%sp
	move.w -12(%fp),%d0
	move.w %d0,%d1
	ext.l %d1
	move.w -10(%fp),%d0
	ext.l %d0
	pea 15.w
	move.l %d1,-(%sp)
	clr.l -(%sp)
	move.l %d0,-(%sp)
	jsr _vertLine
	lea (16,%sp),%sp
	move.w -10(%fp),%d0
	add.w #-10,%d0
	move.w %d0,%d1
	ext.l %d1
	move.w -12(%fp),%d0
	ext.l %d0
	pea 15.w
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	pea 10.w
	jsr _horzLine
	lea (16,%sp),%sp
	pea .LC3
	jsr _GpibInput
	addq.l #4,%sp
	jsr draw_lines_text
	unlk %fp
	rts
	.size	tetris_prepare, .-tetris_prepare
	.align	2
	.globl	tetris_cycle
	.type	tetris_cycle, @function
tetris_cycle:
	link.w %fp,#-4
	move.l 8(%fp),%d0
	move.w %d0,-4(%fp)
	clr.b -1(%fp)
	cmp.w #-16374,-4(%fp)
	jne .L15
	move.b piecex,%d0
	tst.b %d0
	jeq .L15
	move.b piecerotation,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a1
	move.b piecetype,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a0
	move.b piecey,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b piecex,%d0
	subq.b #1,%d0
	move.b %d0,%d0
	and.l #255,%d0
	clr.l -(%sp)
	clr.l -(%sp)
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr set_piece
	lea (24,%sp),%sp
	tst.b %d0
	jne .L15
	move.b piecex,%d0
	subq.b #1,%d0
	move.b %d0,piecex
.L15:
	cmp.w #-16372,-4(%fp)
	jne .L16
	move.b piecex,%d0
	cmp.b #99,%d0
	jhi .L16
	move.b piecerotation,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a1
	move.b piecetype,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a0
	move.b piecey,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b piecex,%d0
	addq.b #1,%d0
	move.b %d0,%d0
	and.l #255,%d0
	clr.l -(%sp)
	clr.l -(%sp)
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr set_piece
	lea (24,%sp),%sp
	tst.b %d0
	jne .L16
	move.b piecex,%d0
	addq.b #1,%d0
	move.b %d0,piecex
.L16:
	cmp.w #-16370,-4(%fp)
	jne .L17
	move.b piecerotation,%d0
	addq.b #1,%d0
	move.b %d0,%d0
	and.l #255,%d0
	moveq #3,%d1
	and.l %d0,%d1
	move.l %d1,%a1
	move.b piecetype,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a0
	move.b piecey,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b piecex,%d0
	move.b %d0,%d0
	and.l #255,%d0
	clr.l -(%sp)
	clr.l -(%sp)
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr set_piece
	lea (24,%sp),%sp
	tst.b %d0
	jne .L18
	move.b piecerotation,%d0
	addq.b #1,%d0
	and.b #3,%d0
	move.b %d0,piecerotation
	jra .L17
.L18:
	move.b piecerotation,%d0
	addq.b #1,%d0
	move.b %d0,%d0
	and.l #255,%d0
	moveq #3,%d1
	and.l %d0,%d1
	move.l %d1,%a1
	move.b piecetype,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a0
	move.b piecey,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b piecex,%d0
	subq.b #1,%d0
	move.b %d0,%d0
	and.l #255,%d0
	clr.l -(%sp)
	clr.l -(%sp)
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr set_piece
	lea (24,%sp),%sp
	tst.b %d0
	jne .L19
	move.b piecerotation,%d0
	addq.b #1,%d0
	and.b #3,%d0
	move.b %d0,piecerotation
	move.b piecex,%d0
	subq.b #1,%d0
	move.b %d0,piecex
	jra .L17
.L19:
	move.b piecerotation,%d0
	addq.b #1,%d0
	move.b %d0,%d0
	and.l #255,%d0
	moveq #3,%d1
	and.l %d0,%d1
	move.l %d1,%a1
	move.b piecetype,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a0
	move.b piecey,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b piecex,%d0
	addq.b #1,%d0
	move.b %d0,%d0
	and.l #255,%d0
	clr.l -(%sp)
	clr.l -(%sp)
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr set_piece
	lea (24,%sp),%sp
	tst.b %d0
	jne .L17
	move.b piecerotation,%d0
	addq.b #1,%d0
	and.b #3,%d0
	move.b %d0,piecerotation
	move.b piecex,%d0
	addq.b #1,%d0
	move.b %d0,piecex
.L17:
	cmp.w #-16373,-4(%fp)
	jne .L20
	move.b #1,speedup
	clr.b turntimeleft
.L20:
	move.b turntimeleft,%d0
	tst.b %d0
	jeq .L21
	move.b turntimeleft,%d0
	subq.b #1,%d0
	move.b %d0,turntimeleft
	jra .L22
.L21:
	move.b speedup,%d0
	tst.b %d0
	jeq .L23
	move.b #1,turntimeleft
	jra .L24
.L23:
	move.b #20,turntimeleft
.L24:
	jsr game_final_fix
	move.b %d0,-1(%fp)
.L22:
	jsr paint_playfield
	tst.b -1(%fp)
	jne .L25
	move.b piecex,%d1
	move.b prev_piecex,%d0
	cmp.b %d1,%d0
	jne .L26
	move.b prev_piecey,%d1
	move.b piecey,%d0
	cmp.b %d1,%d0
	jne .L26
	move.b prev_piecerotation,%d1
	move.b piecerotation,%d0
	cmp.b %d1,%d0
	jne .L26
	move.b prev_piecetype,%d1
	move.b piecetype,%d0
	cmp.b %d1,%d0
	jeq .L25
.L26:
	move.b prev_piecerotation,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a1
	move.b prev_piecetype,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a0
	move.b prev_piecey,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b prev_piecex,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr clear_piece
	lea (16,%sp),%sp
	move.b piecerotation,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a1
	move.b piecetype,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a0
	move.b piecey,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b piecex,%d0
	move.b %d0,%d0
	and.l #255,%d0
	pea 1.w
	clr.l -(%sp)
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr set_piece
	lea (24,%sp),%sp
.L25:
	move.b piecex,%d0
	move.b %d0,prev_piecex
	move.b piecey,%d0
	move.b %d0,prev_piecey
	move.b piecerotation,%d0
	move.b %d0,prev_piecerotation
	move.b piecetype,%d0
	move.b %d0,prev_piecetype
	unlk %fp
	rts
	.size	tetris_cycle, .-tetris_cycle
	.align	2
	.globl	game_final_fix
	.type	game_final_fix, @function
game_final_fix:
	link.w %fp,#-4
	move.b piecerotation,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a1
	move.b piecetype,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a0
	move.b piecey,%d0
	addq.b #1,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b piecex,%d0
	move.b %d0,%d0
	and.l #255,%d0
	clr.l -(%sp)
	clr.l -(%sp)
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr set_piece
	lea (24,%sp),%sp
	tst.b %d0
	jne .L28
	move.b piecey,%d0
	addq.b #1,%d0
	move.b %d0,piecey
	clr.b %d0
	jra .L29
.L28:
	clr.b speedup
	move.b piecerotation,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a1
	move.b piecetype,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a0
	move.b piecey,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b piecex,%d0
	move.b %d0,%d0
	and.l #255,%d0
	clr.l -(%sp)
	pea 1.w
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr set_piece
	lea (24,%sp),%sp
	jsr paint_playfield
	pea 1.w
	pea 1.w
	jsr remove_complete_rows
	addq.l #8,%sp
	move.b %d0,-2(%fp)
	tst.b -2(%fp)
	jeq .L30
	clr.b -1(%fp)
	jra .L31
.L32:
	jsr paint_playfield
	pea 1.w
	clr.l -(%sp)
	jsr remove_complete_rows
	addq.l #8,%sp
	addq.b #1,-1(%fp)
.L31:
	cmp.b #4,-1(%fp)
	jls .L32
	clr.w %d0
	move.b -2(%fp),%d0
	move.w tetris_lines,%d1
	add.w %d1,%d0
	move.w %d0,tetris_lines
	jsr draw_lines_text
.L30:
	move.b #4,piecex
	move.b #1,piecey
	move.b nextcursor,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b nextpieces(%d1.l),%d1
	move.b %d1,piecetype
	addq.b #1,%d0
	move.b %d0,nextcursor
	clr.b piecerotation
	move.b nextcursor,%d0
	cmp.b #6,%d0
	jls .L33
	jsr generate_next_pieces
	clr.b nextcursor
.L33:
	jsr paint_next_piece
	move.b piecerotation,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a1
	move.b piecetype,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a0
	move.b piecey,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b piecex,%d0
	move.b %d0,%d0
	and.l #255,%d0
	clr.l -(%sp)
	clr.l -(%sp)
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr set_piece
	lea (24,%sp),%sp
	tst.b %d0
	jeq .L34
	move.b #1,game_over
	clr.b %d0
	jra .L29
.L34:
	moveq #1,%d0
.L29:
	unlk %fp
	rts
	.size	game_final_fix, .-game_final_fix
	.align	2
	.globl	generate_next_pieces
	.type	generate_next_pieces, @function
generate_next_pieces:
	link.w %fp,#-4
	clr.b -1(%fp)
	jra .L36
.L37:
	clr.l %d0
	move.b -1(%fp),%d0
	move.b -1(%fp),nextpieces(%d0.l)
	addq.b #1,-1(%fp)
.L36:
	cmp.b #6,-1(%fp)
	jls .L37
	jsr _tickGet
	move.l %d0,%a0
	move.l %a0,%d1
	mulu.l #613566757,%d0:%d1
	move.l %a0,%d1
	sub.l %d0,%d1
	lsr.l #1,%d1
	add.l %d1,%d0
	move.l %d0,%d1
	lsr.l #2,%d1
	move.l %d1,%d0
	lsl.l #3,%d0
	sub.l %d1,%d0
	move.l %a0,%d1
	sub.l %d0,%d1
	move.b %d1,-2(%fp)
	clr.b -1(%fp)
	jra .L38
.L40:
	addq.b #1,-2(%fp)
	cmp.b #6,-2(%fp)
	jls .L39
	clr.b -2(%fp)
.L39:
	clr.l %d0
	move.b -1(%fp),%d0
	move.b nextpieces(%d0.l),-3(%fp)
	clr.l %d0
	move.b -1(%fp),%d0
	clr.l %d1
	move.b -2(%fp),%d1
	move.b nextpieces(%d1.l),%d1
	move.b %d1,nextpieces(%d0.l)
	clr.l %d0
	move.b -2(%fp),%d0
	move.b -3(%fp),nextpieces(%d0.l)
	addq.b #1,-1(%fp)
.L38:
	cmp.b #5,-1(%fp)
	jls .L40
	unlk %fp
	rts
	.size	generate_next_pieces, .-generate_next_pieces
	.align	2
	.globl	paint_next_piece
	.type	paint_next_piece, @function
paint_next_piece:
	link.w %fp,#-4
	move.b nextcursor,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.b nextpieces(%d0.l),-3(%fp)
	clr.b -2(%fp)
	jra .L42
.L45:
	clr.b -1(%fp)
	jra .L43
.L44:
	clr.l %d0
	move.b -3(%fp),%d0
	move.l %d0,%d1
	lsl.l #6,%d1
	clr.l %d0
	move.b -1(%fp),%d0
	add.l %d0,%d1
	clr.l %d0
	move.b -2(%fp),%d0
	lsl.l #2,%d0
	add.l %d1,%d0
	move.b pieceShapes(%d0.l),-4(%fp)
	clr.l %d0
	move.b -4(%fp),%d0
	move.l %d0,%a0
	move.b -2(%fp),%d0
	addq.b #2,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b -1(%fp),%d0
	add.b #15,%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr paint_tile
	lea (12,%sp),%sp
	addq.b #1,-1(%fp)
.L43:
	cmp.b #3,-1(%fp)
	jls .L44
	addq.b #1,-2(%fp)
.L42:
	cmp.b #3,-2(%fp)
	jls .L45
	unlk %fp
	rts
	.size	paint_next_piece, .-paint_next_piece
	.align	2
	.globl	clear_piece
	.type	clear_piece, @function
clear_piece:
	link.w %fp,#-12
	move.l %d2,-(%sp)
	move.l 8(%fp),%a1
	move.l 12(%fp),%a0
	move.l 16(%fp),%d1
	move.l 20(%fp),%d0
	move.w %a1,%d2
	move.b %d2,-6(%fp)
	move.w %a0,%d2
	move.b %d2,-8(%fp)
	move.b %d1,-10(%fp)
	move.b %d0,-12(%fp)
	clr.b -1(%fp)
	jra .L47
.L49:
	clr.l %d0
	move.b -10(%fp),%d0
	move.l %d0,%d1
	lsl.l #2,%d1
	clr.l %d0
	move.b -12(%fp),%d0
	add.l %d1,%d0
	move.l %d0,%d1
	lsl.l #4,%d1
	clr.l %d0
	move.b -1(%fp),%d0
	add.l %d1,%d0
	move.b pieceShapes(%d0.l),-2(%fp)
	tst.b -2(%fp)
	jeq .L48
	move.b -1(%fp),%d0
	and.b #3,%d0
	add.b -6(%fp),%d0
	move.b %d0,%d1
	subq.b #1,%d1
	move.b %d1,-3(%fp)
	move.b -1(%fp),%d0
	lsr.b #2,%d0
	add.b -8(%fp),%d0
	move.b %d0,%d2
	subq.b #1,%d2
	move.b %d2,-4(%fp)
	cmp.b #9,-3(%fp)
	jhi .L48
	cmp.b #19,-4(%fp)
	jhi .L48
	clr.l %d1
	move.b -4(%fp),%d1
	clr.l %d0
	move.b -3(%fp),%d0
	clr.l -(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr paint_tile
	lea (12,%sp),%sp
.L48:
	addq.b #1,-1(%fp)
.L47:
	cmp.b #15,-1(%fp)
	jls .L49
	move.l -16(%fp),%d2
	unlk %fp
	rts
	.size	clear_piece, .-clear_piece
	.align	2
	.globl	set_piece
	.type	set_piece, @function
set_piece:
	link.w %fp,#-20
	move.l %d3,-(%sp)
	move.l %d2,-(%sp)
	move.l 8(%fp),%d3
	move.l 12(%fp),%d2
	move.l 16(%fp),%a1
	move.l 20(%fp),%a0
	move.l 24(%fp),%d1
	move.l 28(%fp),%d0
	move.b %d3,-8(%fp)
	move.b %d2,-10(%fp)
	move.w %a1,%d2
	move.b %d2,-12(%fp)
	move.w %a0,%d2
	move.b %d2,-14(%fp)
	move.b %d1,-16(%fp)
	move.b %d0,-18(%fp)
	clr.b -1(%fp)
	clr.b -2(%fp)
	jra .L51
.L57:
	clr.l %d0
	move.b -12(%fp),%d0
	move.l %d0,%d1
	lsl.l #2,%d1
	clr.l %d0
	move.b -14(%fp),%d0
	add.l %d1,%d0
	move.l %d0,%d1
	lsl.l #4,%d1
	clr.l %d0
	move.b -2(%fp),%d0
	add.l %d1,%d0
	move.b pieceShapes(%d0.l),-3(%fp)
	tst.b -3(%fp)
	jeq .L52
	move.b -2(%fp),%d0
	and.b #3,%d0
	add.b -8(%fp),%d0
	move.b %d0,%d1
	subq.b #1,%d1
	move.b %d1,-4(%fp)
	move.b -2(%fp),%d0
	lsr.b #2,%d0
	add.b -10(%fp),%d0
	move.b %d0,%d2
	subq.b #1,%d2
	move.b %d2,-5(%fp)
	cmp.b #9,-4(%fp)
	jhi .L53
	cmp.b #19,-5(%fp)
	jls .L54
.L53:
	move.b #1,-1(%fp)
	jra .L52
.L54:
	clr.l %d0
	move.b -4(%fp),%d0
	clr.l %d1
	move.b -5(%fp),%d1
	lsl.l #2,%d0
	move.l %d0,%d2
	lsl.l #2,%d2
	move.l %d2,%a0
	add.l %a0,%d0
	add.l %d1,%d0
	add.l #playfield,%d0
	move.l %d0,%a0
	move.b (%a0),%d0
	tst.b %d0
	jeq .L55
	move.b #1,-1(%fp)
.L55:
	tst.b -16(%fp)
	jeq .L56
	clr.l %d0
	move.b -4(%fp),%d0
	clr.l %d1
	move.b -5(%fp),%d1
	lsl.l #2,%d0
	move.l %d0,%d2
	lsl.l #2,%d2
	move.l %d2,%a0
	add.l %a0,%d0
	add.l %d1,%d0
	add.l #playfield,%d0
	move.l %d0,%a0
	move.b -3(%fp),(%a0)
	move.b #1,playfield_changed
.L56:
	tst.b -18(%fp)
	jeq .L52
	clr.l %d0
	move.b -3(%fp),%d0
	move.l %d0,%a0
	clr.l %d1
	move.b -5(%fp),%d1
	clr.l %d0
	move.b -4(%fp),%d0
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr paint_tile
	lea (12,%sp),%sp
.L52:
	addq.b #1,-2(%fp)
.L51:
	cmp.b #15,-2(%fp)
	jls .L57
	move.b -1(%fp),%d0
	move.l -28(%fp),%d2
	move.l -24(%fp),%d3
	unlk %fp
	rts
	.size	set_piece, .-set_piece
	.align	2
	.globl	remove_complete_rows
	.type	remove_complete_rows, @function
remove_complete_rows:
	link.w %fp,#-8
	move.l %a2,-(%sp)
	move.l %d2,-(%sp)
	move.l 8(%fp),%d1
	move.l 12(%fp),%d0
	move.b %d1,-6(%fp)
	move.b %d0,-8(%fp)
	clr.b -3(%fp)
	move.b #20,-1(%fp)
	jra .L60
.L70:
	move.b #1,-4(%fp)
	clr.b -2(%fp)
	jra .L61
.L63:
	clr.l %d0
	move.b -2(%fp),%d0
	clr.l %d1
	move.b -1(%fp),%d1
	lsl.l #2,%d0
	move.l %d0,%d2
	lsl.l #2,%d2
	move.l %d2,%a0
	add.l %a0,%d0
	add.l %d1,%d0
	add.l #playfield,%d0
	move.l %d0,%a0
	move.b (%a0),%d0
	tst.b %d0
	jne .L62
	clr.b -4(%fp)
.L62:
	addq.b #1,-2(%fp)
.L61:
	cmp.b #9,-2(%fp)
	jls .L63
	tst.b -4(%fp)
	jeq .L64
	addq.b #1,-3(%fp)
	tst.b -8(%fp)
	jeq .L65
	cmp.b #3,-1(%fp)
	jls .L65
	clr.b -2(%fp)
	jra .L66
.L67:
	move.b -1(%fp),%d0
	subq.b #4,%d0
	clr.l %d1
	move.b %d0,%d1
	move.b -2(%fp),%d0
	addq.b #2,%d0
	move.b %d0,%d0
	and.l #255,%d0
	clr.l -(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr paint_tile
	lea (12,%sp),%sp
	addq.b #1,-2(%fp)
.L66:
	cmp.b #9,-2(%fp)
	jls .L67
	jra .L65
.L64:
	tst.b -6(%fp)
	jne .L65
	clr.b -2(%fp)
	jra .L68
.L69:
	clr.l %d0
	move.b -2(%fp),%d0
	move.l %d0,%a1
	clr.l %d1
	move.b -1(%fp),%d1
	clr.l %d0
	move.b -3(%fp),%d0
	move.l %d1,%a0
	add.l %d0,%a0
	clr.l %d0
	move.b -2(%fp),%d0
	clr.l %d1
	move.b -1(%fp),%d1
	lsl.l #2,%d0
	move.l %d0,%d2
	lsl.l #2,%d2
	add.l %d2,%d0
	add.l %d1,%d0
	add.l #playfield,%d0
	move.l %d0,%a2
	move.b (%a2),%d1
	move.l %a1,%d0
	lsl.l #2,%d0
	move.l %d0,%d2
	lsl.l #2,%d2
	move.l %d2,%a1
	add.l %a1,%d0
	add.l %a0,%d0
	add.l #playfield,%d0
	move.l %d0,%a0
	move.b %d1,(%a0)
	move.b #1,playfield_changed
	addq.b #1,-2(%fp)
.L68:
	cmp.b #9,-2(%fp)
	jls .L69
.L65:
	subq.b #1,-1(%fp)
.L60:
	cmp.b #-1,-1(%fp)
	jne .L70
	tst.b -6(%fp)
	jne .L71
	clr.b -1(%fp)
	jra .L72
.L75:
	clr.b -2(%fp)
	jra .L73
.L74:
	clr.l %d0
	move.b -2(%fp),%d0
	clr.l %d1
	move.b -1(%fp),%d1
	lsl.l #2,%d0
	move.l %d0,%d2
	lsl.l #2,%d2
	move.l %d2,%a0
	add.l %a0,%d0
	add.l %d1,%d0
	add.l #playfield,%d0
	move.l %d0,%a0
	clr.b (%a0)
	addq.b #1,-2(%fp)
.L73:
	cmp.b #9,-2(%fp)
	jls .L74
	move.b #1,playfield_changed
	addq.b #1,-1(%fp)
.L72:
	move.b -1(%fp),%d0
	cmp.b -3(%fp),%d0
	jcs .L75
.L71:
	move.b -3(%fp),%d0
	move.l -16(%fp),%d2
	move.l -12(%fp),%a2
	unlk %fp
	rts
	.size	remove_complete_rows, .-remove_complete_rows
	.data
.LC4:
	.string	"mess:show \"\n  LINES: %04d\""
	.text
	.align	2
	.globl	draw_lines_text
	.type	draw_lines_text, @function
draw_lines_text:
	link.w %fp,#-32
	move.w tetris_lines,%d0
	move.w %d0,%d0
	and.l #65535,%d0
	move.l %d0,-(%sp)
	pea .LC4
	moveq #-32,%d0
	add.l %fp,%d0
	move.l %d0,-(%sp)
	jsr _sprintf
	lea (12,%sp),%sp
	moveq #-32,%d0
	add.l %fp,%d0
	move.l %d0,-(%sp)
	jsr _GpibInput
	addq.l #4,%sp
	unlk %fp
	rts
	.size	draw_lines_text, .-draw_lines_text
	.align	2
	.globl	paint_playfield
	.type	paint_playfield, @function
paint_playfield:
	link.w %fp,#-4
	move.l %d2,-(%sp)
	clr.b -1(%fp)
	clr.b -2(%fp)
	move.b playfield_changed,%d0
	tst.b %d0
	jeq .L85
.L79:
	clr.b -1(%fp)
	jra .L81
.L84:
	clr.b -2(%fp)
	jra .L82
.L83:
	clr.l %d0
	move.b -1(%fp),%d0
	clr.l %d1
	move.b -2(%fp),%d1
	lsl.l #2,%d0
	move.l %d0,%d2
	lsl.l #2,%d2
	move.l %d2,%a0
	add.l %a0,%d0
	add.l %d1,%d0
	add.l #playfield,%d0
	move.l %d0,%a0
	move.b (%a0),%d0
	move.b %d0,%d0
	and.l #255,%d0
	move.l %d0,%a0
	clr.l %d1
	move.b -2(%fp),%d1
	clr.l %d0
	move.b -1(%fp),%d0
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr paint_tile
	lea (12,%sp),%sp
	addq.b #1,-2(%fp)
.L82:
	cmp.b #19,-2(%fp)
	jls .L83
	addq.b #1,-1(%fp)
.L81:
	cmp.b #9,-1(%fp)
	jls .L84
	clr.b playfield_changed
	jra .L78
.L85:
	nop
.L78:
	move.l -8(%fp),%d2
	unlk %fp
	rts
	.size	paint_playfield, .-paint_playfield
	.align	2
	.globl	paint_tile
	.type	paint_tile, @function
paint_tile:
	link.w %fp,#-12
	move.l %d2,-(%sp)
	move.l 8(%fp),%a0
	move.l 12(%fp),%d1
	move.l 16(%fp),%d0
	move.w %a0,%d2
	move.b %d2,-8(%fp)
	move.b %d1,-10(%fp)
	move.b %d0,-12(%fp)
	clr.b -1(%fp)
	tst.b -12(%fp)
	jeq .L87
	st -1(%fp)
.L87:
	clr.w %d0
	move.b -8(%fp),%d0
	move.w %d0,%a0
	move.w %a0,%d0
	lsl.w #3,%d0
	move.w %d0,%d1
	lsl.w #2,%d1
	sub.w %d0,%d1
	move.w %d1,%d0
	sub.w %a0,%d0
	move.w %d0,%d1
	add.w #10,%d1
	move.w %d1,-4(%fp)
	clr.w %d2
	move.b -10(%fp),%d2
	move.w %d2,%a0
	move.w %a0,%d0
	lsl.w #3,%d0
	move.w %d0,%d1
	lsl.w #2,%d1
	sub.w %d0,%d1
	move.w %d1,%d0
	sub.w %a0,%d0
	move.w %d0,-6(%fp)
	clr.l %d1
	move.b -1(%fp),%d1
	move.l %d1,%a0
	clr.l %d1
	move.w -6(%fp),%d1
	clr.l %d0
	move.w -4(%fp),%d0
	move.l %a0,-(%sp)
	pea 20.w
	pea 20.w
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr draw_rectangle
	lea (20,%sp),%sp
	move.l -16(%fp),%d2
	unlk %fp
	rts
	.size	paint_tile, .-paint_tile
	.align	2
	.globl	draw_rectangle
	.type	draw_rectangle, @function
draw_rectangle:
	link.w %fp,#-12
	move.l %d2,-(%sp)
	move.l 8(%fp),%d2
	move.l 12(%fp),%a1
	move.l 16(%fp),%a0
	move.l 20(%fp),%d1
	move.l 24(%fp),%d0
	move.w %d2,-2(%fp)
	move.w %a1,-4(%fp)
	move.w %a0,-6(%fp)
	move.w %d1,-8(%fp)
	move.b %d0,-10(%fp)
	move.b -10(%fp),%d0
	move.b %d0,%d1
	extb.l %d1
	move.l %d1,%a0
	move.w -4(%fp),%d0
	add.w #10,%d0
	move.w %d0,%d1
	ext.l %d1
	move.w -2(%fp),%d0
	addq.w #5,%d0
	ext.l %d0
	move.l %a0,-(%sp)
	pea 10.w
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr _horzLine
	lea (16,%sp),%sp
	move.b -10(%fp),%d0
	move.b %d0,%d1
	extb.l %d1
	move.l %d1,%a1
	move.w -6(%fp),%d0
	move.w %d0,%a0
	move.w -4(%fp),%d0
	move.w %d0,%d1
	ext.l %d1
	move.w -2(%fp),%d0
	ext.l %d0
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr _horzLine
	lea (16,%sp),%sp
	move.b -10(%fp),%d0
	move.b %d0,%d1
	extb.l %d1
	move.l %d1,%a1
	move.w -6(%fp),%d0
	move.w %d0,%a0
	move.w -4(%fp),%d0
	add.w -8(%fp),%d0
	move.w %d0,%d1
	ext.l %d1
	move.w -2(%fp),%d0
	ext.l %d0
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr _horzLine
	lea (16,%sp),%sp
	clr.l %d0
	move.b -10(%fp),%d0
	move.l %d0,%a1
	move.w -8(%fp),%d0
	move.w %d0,%a0
	move.w -4(%fp),%d0
	move.w %d0,%d1
	ext.l %d1
	move.w -2(%fp),%d0
	ext.l %d0
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr _vertLine
	lea (16,%sp),%sp
	clr.l %d1
	move.b -10(%fp),%d1
	move.l %d1,%a1
	move.w -8(%fp),%d0
	move.w %d0,%a0
	move.w -4(%fp),%d0
	move.w %d0,%d1
	ext.l %d1
	move.w -2(%fp),%d0
	add.w -6(%fp),%d0
	ext.l %d0
	move.l %a1,-(%sp)
	move.l %a0,-(%sp)
	move.l %d1,-(%sp)
	move.l %d0,-(%sp)
	jsr _vertLine
	lea (16,%sp),%sp
	move.l -16(%fp),%d2
	unlk %fp
	rts
	.size	draw_rectangle, .-draw_rectangle
	.ident	"GCC: (GNU) 4.7.0"
